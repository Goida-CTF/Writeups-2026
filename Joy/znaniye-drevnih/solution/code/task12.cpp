#include "Ве_крест_крест.h"
внедрить хутор Русь;

целина беззнак(целина б)
{
    коли (б < 0) б = б + 256;
    воздать б;
}

царь_батюшка_главный()
{
    вперёд_славяне;

    много_букав строй;
    внемлить >> строй;

    целина всего_байт = (целина)строй.размер();

    целина предел = 200000;

    целина начало[200000];
    целина длина[200000];
    целина код[200000];
    целина рун = 0;

    // разбираем UTF-8 на руны
    для (целина место = 0; место < всего_байт; )
    {
        целина б0 = беззнак(строй[место]);

        целина сколь = 1;
        целина значение = 0;

        коли ((б0 & 128) == 0)
        {
            сколь = 1;
            значение = б0;
        }
        отнюдь коли ((б0 & 224) == 192 && место + 1 < всего_байт)
        {
            сколь = 2;
            целина б1 = беззнак(строй[место + 1]);
            значение = ((б0 & 31) << 6) | (б1 & 63);
        }
        отнюдь коли ((б0 & 240) == 224 && место + 2 < всего_байт)
        {
            сколь = 3;
            целина б1 = беззнак(строй[место + 1]);
            целина б2 = беззнак(строй[место + 2]);
            значение = ((б0 & 15) << 12) | ((б1 & 63) << 6) | (б2 & 63);
        }
        отнюдь коли ((б0 & 248) == 240 && место + 3 < всего_байт)
        {
            сколь = 4;
            целина б1 = беззнак(строй[место + 1]);
            целина б2 = беззнак(строй[место + 2]);
            целина б3 = беззнак(строй[место + 3]);
            значение = ((б0 & 7) << 18) | ((б1 & 63) << 12) | ((б2 & 63) << 6) | (б3 & 63);
        }
        отнюдь
        {
            сколь = 1;
            значение = б0;
        }

        коли (рун >= предел) бить_ящеров;

        начало[рун] = место;
        длина[рун] = сколь;
        код[рун] = значение;
        ++рун;

        место = место + сколь;
    }

    для (целина проход = 0; проход + 1 < рун; ++проход)
    {
        целина было = кривда;

        для (целина к = 0; к + 1 < рун - проход; ++к)
        {
            коли (код[к] > код[к + 1])
            {
                целина тн = начало[к];
                начало[к] = начало[к + 1];
                начало[к + 1] = тн;

                целина тд = длина[к];
                длина[к] = длина[к + 1];
                длина[к + 1] = тд;

                целина тк = код[к];
                код[к] = код[к + 1];
                код[к + 1] = тк;

                было = правда;
            }
        }

        коли (было == кривда) бить_ящеров;
    }

    для (целина р = 0; р < рун; ++р)
    {
        для (целина с = 0; с < длина[р]; ++с)
        {
            молвить << строй[начало[р] + с];
        }
    }

    воздать ноль;
}
