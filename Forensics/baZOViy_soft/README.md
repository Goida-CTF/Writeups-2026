# БаZOVый софт
Сложность: `Средне`

Описание:

    Мишка Миша работает в ООО "БаZOVая компания". За день до отпуска Миша спокойно сидел на обеде в столовой своего офиса в тот момент, когда к нему подошел "сотрудник" соседнего отдела. Так называемый "сотрудник" быстро втерся в доверие к Мише и сказал "шо скоро нас всiх переведут на удаленку хде будэм отдыхать", добавив, что для того, чтобы не заморачиваться в рабочее время с установкой всего нужного он готов любезно предоставить Мише флешку с некоторым базовым софтом для работы на удаленке. Миша, будучи в приподнятом настроении от скорого перевода на удаленку, конечно же принял эту флешку и установил программное обеспечение на свой компьютер, ведь было бы прекрасно разобраться со всем необходимым во время отдыха и подойти во всеоружии к первому дню на удаленке.
	Вы же все понимаете, какой говор был у "сотрудника" и что это был не совсем обычный софт...
	
	ВНИМАНИЕ: ЗАДАНИЕ СОДЕРЖИТ ДЕЙСТВУЮЩЕЕ ВРЕДОНОСНОЕ ПО. ИСПОЛЬЗУЙТЕ ИЗОЛИРОВАННУЮ СРЕДУ ДЛЯ РЕШЕНИЯ. ОРГАНИЗАТОРЫ GoidaCTF 2026 И АВТОР ЗАДАНИЯ НЕ НЕСУТ ОТВЕТСТВЕННОСТИ ЗА УРОН, ПРИЧИНЕННЫЙ ВАШЕЙ СИСТЕМЕ В ХОДЕ РЕШЕНИЯ ДАННОЙ ЗАДАЧИ.


## Теги
`#forensics` `#windows` `#image` `#binaryanalysis`

## Выдать участникам
[Файл к заданию (Google Drive)](https://drive.google.com/drive/folders/1S8GhyL-xWN_YRvsG7LsaY4SwYK44aoFU)

## Решение
Нам дается некоторая легенда и архив. Распакуя его, увидим .vdi образ диска компьютера Миши.
Откроем его в любой удобной вам программе для анализа образов дисков. Я буду использовать R-Studio, т.к эта программа прекрасно работает с .vdi образами и позволяет быстро и удобно получить первичную картину диска для дальнейшего более глубокого анализа в других программах.

![Main drive tree](https://github.com/k10nex/goidactf2026quals-tasks/blob/main/Forensics/baZOViy_soft/pics-for-writeup/rstudio-1.png)

На машине есть только один пользователь - `Admin`.
Перейдем в его рабочую папку и осмотримся.
В рабочей папке замечаем папку DISTR. Несложными размышлениями можно прийти к тому, что эта папка содержит дистрибутивы программ. Заходим туда:

![DISTR dir](https://github.com/k10nex/goidactf2026quals-tasks/blob/main/Forensics/baZOViy_soft/pics-for-writeup/rstudio-2.png)

Видим файл под названием `baZOViy_soft_installer.exe`. Видимо, это и есть установщик того софта, который Мише передали на флешке. Миша, как умный медведь, конечно скопировал его на свой диск в отдельную папку с дистрибутивами, чтобы у него под рукой всегда был инсталлятор на всякий случай.
Сохраним себе этот установщик, перейдем на тестовую виртуальную машину и посмотрим, что он вообще делает.

![Installer main page](https://github.com/k10nex/goidactf2026quals-tasks/blob/main/Forensics/baZOViy_soft/pics-for-writeup/installer-mainpage.png)

Установим программу. Если быть достаточно внимательным, можно заметить, что на этапе установки у нас на некоторое количество времени на экране появляется окно Powershell, которое затем исчезает. Это определенно настораживает - с установщиком что-то нечисто.
Этот установщик собран с использованием ПО InnoSetup - это можно узнать скормив его Detect it Easy:

![Installer DIE](https://github.com/k10nex/goidactf2026quals-tasks/blob/main/Forensics/baZOViy_soft/pics-for-writeup/die-installer.png)

Несложным поиском в сети Интернет находим софт под названием [InnoUnpacker](https://github.com/jrathlev/InnoUnpacker-Windows-GUI). Читаем ридми, скачиваем подходящую нам версию программы и пробуем применить ее на наш установщик:

![Unpacking installer](https://github.com/k10nex/goidactf2026quals-tasks/blob/main/Forensics/baZOViy_soft/pics-for-writeup/installer-extracted.png)

Отлично - получаем установочный скрипт и саму программу, которую инсталлер устанавливает на компьютер.
Посмотрим, что находится в скрипте:

![Installer script](https://github.com/k10nex/goidactf2026quals-tasks/blob/main/Forensics/baZOViy_soft/pics-for-writeup/installer-script.png)

Видим причину появления окна Powershell - установщику была дана команда выполнить некоторый закодированный в Base64 скрипт. Посмотрим, что в нем используя CyberChef:

![Decoded pwsh script](https://github.com/k10nex/goidactf2026quals-tasks/blob/main/Forensics/baZOViy_soft/pics-for-writeup/decrypted-installer-script.png)

Видим вредоносный немножко обфусцированный скрипт. Внимание привлекает Base64-строка, которая задана в скрипте плейнтекстом. Декодируем:

![FLAG part1](https://github.com/k10nex/goidactf2026quals-tasks/blob/main/Forensics/baZOViy_soft/pics-for-writeup/part1-decrypted.png)

Получаем первую часть флага.

> PART1:`goidactf{d0_n07_7RU57_r4nd0m_`

Идем дальше. Установщик установил какую-то программу, а так как вредоносное содержание было даже в установщике - очевидно, что установленная программа также будет вредоносной. Семпл ВПО мы уже получили в прошлом шаге, приступим к его разбору.
Выполнив `strings` по программе можно обнаружить, что программа собрана pyinstaller'ом, а также используется PyArmor.
На этом этапе желание реверсить ВПО должно пропасть - исходный скрипт написан на Python  и обфусцирован десятью слоями PyObfuscate + PyArmor. Да и в конце концов, мы пришли сюда респонсить, а не реверсить. Поэтому берем семпл и отправляемся на поклон к любой (не обязательно) интерактивной песочнице, которая позволит провести нам поведенческий анализ ВПО без лишних заморочек.

Я буду использовать [any.run](https://app.any.run/). Выгружаем туда бинарь, ждем пока закончится анализ и видим нестандартно большое количество DNS-запросов, совершенных машиной. Скрываем запросы до вайтлист-доменов и смотрим на итоговый список:

![Suspicious DNS activity](https://github.com/k10nex/goidactf2026quals-tasks/blob/main/Forensics/baZOViy_soft/pics-for-writeup/sussy-dns-detected.png)

Похоже на DNS-beacon. Домен четвертого уровня в запросах постоянно изменяется, при этом его значения очень уж похожи на hex-байтики. Перепишем все значения домена четвертого уровня в CyberChef (благо всего запросов не особо много) и посмотрим, что он нам скажет:

![FLAG part2](https://github.com/k10nex/goidactf2026quals-tasks/blob/main/Forensics/baZOViy_soft/pics-for-writeup/part2-decrypted.png)

Получаем вторую часть флага.

> PART2:`guy5_1nC4F3tErIA}`

Собираем флаг и сдаем.

## Флаг
    goidactf{d0_n07_7RU57_r4nd0m_guy5_1nC4F3tErIA}
